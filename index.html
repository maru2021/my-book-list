<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>マイ・ブックカタログ</title>
    <style>
        body { font-family: "Helvetica Neue", Arial, sans-serif; background-color: #f0f2f5; margin: 0; padding: 0; color: #333; }
        .site-header { background: #fff; text-align: center; padding: 40px 20px; border-bottom: 1px solid #ddd; margin-bottom: 20px; }
        .site-header img { max-width: 100px; border-radius: 50%; margin-bottom: 15px; }
        .site-header h1 { margin: 0; font-size: 26px; color: #222; }
        .site-header p { color: #666; margin-top: 8px; font-size: 15px; }
        .ad-disclosure { font-size: 11px; color: #aaa; margin-top: 15px; font-style: italic; }

        .container { max-width: 1200px; margin: 0 auto; padding: 0 20px; }

        /* タブ切り替えのスタイル */
        .tabs { display: flex; justify-content: center; gap: 10px; margin-bottom: 30px; }
        .tab-btn { padding: 10px 20px; cursor: pointer; border: none; background: #ddd; border-radius: 20px; font-weight: bold; transition: 0.3s; font-size: 14px; }
        .tab-btn.active { background: #ff9900; color: white; }

        .grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(240px, 1fr)); gap: 25px; padding-bottom: 50px; }
        
        .card { background: white; border-radius: 12px; position: relative !important; overflow: visible !important; box-shadow: 0 4px 15px rgba(0,0,0,0.08); display: flex; flex-direction: column; padding: 20px; transition: transform 0.2s; }
        .card:hover { transform: translateY(-5px); }
        
        .post-date { position: absolute; top: 10px; right: 15px; font-size: 10px; color: #bbb; }
        .card img { width: 100%; height: 180px; object-fit: contain; background: #f9f9f9; margin-bottom: 15px; }
        .card h3 { font-size: 16px; margin: 5px 0 5px 0; min-height: 2.8em; line-height: 1.4; color: #111; }
        
        .rating { font-size: 16px; color: #ffc107; margin-bottom: 8px; }
        .badge { color: #c40000; font-weight: bold; font-size: 12px; margin-bottom: 12px; display: block; }
        .comment { font-size: 14px; color: #555; text-align: left; line-height: 1.6; margin-bottom: 20px; flex-grow: 1; white-space: pre-wrap; }
        
        .btn { background: #ff9900; color: white; text-decoration: none; padding: 12px; border-radius: 6px; font-weight: bold; transition: 0.2s; text-align: center; font-size: 14px; }
        .btn:hover { background: #e68a00; }

        @media (max-width: 480px) { .grid { grid-template-columns: 1fr; } }

      /* 【赤丸】位置は変えず、少しだけサイズ調整してスッキリさせる */
.quick-read-badge {
    position: absolute !important;
    top: -15px !important;
    left: -15px !important; /* 左上にはみ出したまま */
    width: 62px;
    height: 62px;
    background: radial-gradient(#ff6b6b, #ee5253) !important;
    color: white !important;
    border-radius: 50% !important;
    display: flex !important;
    align-items: center;
    justify-content: center;
    font-size: 11px;
    font-weight: 900;
    text-align: center;
    line-height: 1.2;
    z-index: 100;
    box-shadow: 3px 3px 8px rgba(0,0,0,0.2);
    transform: rotate(-15deg);
    border: 2px solid white;
    pointer-events: none;
}

/* 【王冠】画像の上に移動させる設定 */
.mega-recommend-badge {
    position: absolute !important;
    top: -50px !important;    /* 縦の位置：本の画像の上あたり */
    left: 50% !important;   /* 横の位置：一旦真ん中に持ってくる */
    transform: translateX(-50%) rotate(0deg) !important; /* ★自分の幅の半分戻して「ど真ん中」＆「まっすぐ」に！ */
    right: auto !important; 

    /* デザイン設定 */
    width: 105px;
    height: 95px;
    display: flex !important;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    z-index: 10;
    pointer-events: none;
    filter: drop-shadow(2px 3px 6px rgba(0,0,0,0.4));
}

/* 王冠アイコン（絵文字）のサイズ */
.crown-icon {
    font-size: 60px; 
    line-height: 1;
    position: relative;
    display: block;
}

/* 王冠の中の「超おすすめ！」文字 */
.mega-recommend-badge span:last-child {
    position: absolute;
    top: 15px;        /* 王冠の胴体部分に重なる位置 */
    color: #4a3900;   /* 濃い茶色で見やすく */
    font-size: 10px;
    font-weight: 900;
    width: 100%;
    text-align: center;
    letter-spacing: -0.5px;
    white-space: nowrap;
}
    </style>
</head>
<body>

    <header class="site-header">
        <img src="logo.png" alt="ロゴ">
        <h1>厳選おすすめ本カタログ</h1>
        <p>今おすすめの良書をピックアップ</p>
        <div class="ad-disclosure">※本サイトはAmazonアソシエイト・プログラムに参加しています</div>
    </header>

    <div class="container">
        <div class="tabs">
            <button class="tab-btn active" onclick="switchTab(true, this)">Kindle Unlimited 0円</button>
            <button class="tab-btn" onclick="switchTab(false, this)">対象外だけど良書！</button>
        </div>

        <div id="book-grid" class="grid"></div>
    </div>

    <script>
        const csvUrl = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vR5ymaarqn9uS9u-UwrEYrQupWrgQdYG13Iqom8ZvKMzkITaXo3GvDPReNPBe2yCfOyho7iw3jb3NIZ/pub?gid=0&single=true&output=csv';
        let allBooks = [];

        function getStars(rating) {
            if (!rating) return ''; 
            let stars = '';
            const fullStars = Math.floor(rating);
            const hasHalfStar = rating % 1 !== 0;
            for (let i = 1; i <= 5; i++) {
                if (i <= fullStars) {
                    stars += '&#9733;';
                } else if (hasHalfStar && i === fullStars + 1) {
                    stars += '<span style="position:relative;display:inline-block;">&#9734;<span style="position:absolute;left:0;top:0;width:50%;overflow:hidden;color:#ffc107;">&#9733;</span></span>';
                } else {
                    stars += '&#9734;';
                }
            }
            return `<div class="rating">${stars} <span style="font-size:12px; color:#999; font-weight:normal;">(${rating})</span></div>`;
        }

        function switchTab(showUnlimited, btnElement) {
            document.querySelectorAll('.tab-btn').forEach(btn => btn.classList.remove('active'));
            btnElement.classList.add('active');
            renderBooks(showUnlimited);
        }

        async function loadBooks() {
            try {
                const response = await fetch(csvUrl);
                const data = await response.text();
                allBooks = data.replace(/\r/g, '').split('\n').filter(row => row.trim() !== '').slice(1).reverse();
                renderBooks(true);
            } catch (e) {
                console.error("読み込みエラー", e);
            }
        }

        function renderBooks(targetStatus) {
            const grid = document.getElementById('book-grid');
            grid.innerHTML = '';

            allBooks.forEach(row => {
                const cols = row.split(/,(?=(?:(?:[^"]*"){2})*[^"]*$)/);
                const rawTitle = (cols[0] || "").replace(/"/g, "").trim();
                if (!rawTitle || rawTitle === "title") return; 

                let checkVal = cols[6] ? cols[6].replace(/"/g, "").trim().toUpperCase() : "FALSE";
                const isUnlimited = (checkVal === "TRUE");

                if (isUnlimited === targetStatus) {
                    const imageUrl = (cols[1] || "").replace(/"/g, "").trim();
                    const amazonUrl = (cols[2] || "").replace(/"/g, "").trim();
                    const comment = (cols[3] || "").replace(/"/g, "").trim();
                    const date = (cols[4] || "").replace(/"/g, "").trim() || "未設定";
                    const rating = parseFloat(cols[5]) || 0; 
                    const badgeHtml = isUnlimited ? '<span class="badge">Kindle Unlimited 0円</span>' : '';

                    // A列にタグが含まれている場合はそのまま出し、タグを除いた部分はh3で囲む
                    // タイトル処理の部分をこれに差し替え
let displayTitle = `<h3>${rawTitle}</h3>`;
// 赤丸バッジと金丸バッジの両方をHTMLとしてそのまま通す
if (rawTitle.includes('badge')) {
    displayTitle = rawTitle.replace(/<\/div>/g, '</div>###').split('###');
    let badges = displayTitle.filter(t => t.includes('badge')).join('');
    let cleanTitle = displayTitle.filter(t => !t.includes('badge')).join('').replace(/<\/?[^>]+(>|$)/g, "");
    displayTitle = `${badges}<h3>${cleanTitle}</h3>`;
}

                    grid.innerHTML += `
                        <div class="card">
                            <div class="post-date">最終確認：${date}</div>
                            <img src="${imageUrl}" alt="">
                            ${displayTitle}
                            ${getStars(rating)} 
                            ${badgeHtml}
                            <div class="comment">${comment}</div>
                            <a href="${amazonUrl}" target="_blank" class="btn">Amazonで詳細を見る</a>
                        </div>
                    `;
                }
            });
        }
        loadBooks();
    </script>
</body>
</html>
